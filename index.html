<!-- index.html -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>學習練習 App</title>
    <link rel="stylesheet" href="style.css">
    
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>

    <div class="header">
        <div class="icon-btn" id="left-action-btn">
            <ion-icon name="person-circle-outline"></ion-icon>
            <span id="login-label" style="font-size: 14px; margin-left: 5px; font-weight: bold; display:none;">登入/註冊</span>
        </div>
        
        <div class="icon-btn" id="back-btn" style="display: none;">
            <ion-icon name="arrow-back-outline"></ion-icon>
        </div>
        
        <div class="header-title" id="header-title">首頁</div>
        
        <div class="icon-btn" style="position: relative;" id="notif-btn">
            <ion-icon name="notifications-outline" style="color: #007AFF;"></ion-icon>
            <div id="badge" class="badge" style="display: none;">0</div>
        </div>
    </div>

<div id="home-screen" class="page active">
        <div class="greeting" id="greeting-text">哈囉!</div>
        
        <div class="card math-card" id="btn-math">
            <h1>📐 數學</h1><p>Mathematics</p>
        </div>
        <div class="card science-card" id="btn-science">
            <h1>🧪 理化</h1><p>Science</p>
        </div>

        <div id="announcement-bar" class="announcement-box">
    <div class="anno-icon">📢</div>
    <div class="anno-content">
        <strong>公告中心 + 常見問題 (2026/01/18更新)</strong><br>
        點擊查看詳情 (含理化勘誤)
    </div>
</div>

        <div id="feedback-bar" class="feedback-box">
            <div class="anno-icon">📬</div> 
            <div class="anno-content">
                <strong>意見箱 (點擊以打開)</strong><br>
                有任何建議或心得？歡迎告訴我們！
            </div>
        </div>

        <div id="teacher-section" style="display:none; padding: 20px; background: #fff3e0; margin-top: 20px; border-radius: 10px;">
            <h2>👨‍🏫 老師後台管理</h2>
            
            <div style="background: #fff; padding: 20px; border-radius: 10px; border: 2px solid #ff9800; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                
                <div style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                    <label style="font-weight:bold; color: #e65100; font-size: 16px;">Step 1: 選擇操作模式</label>
                    <select id="admin-unit-select" style="padding: 10px; width: 100%; margin-top: 5px; border: 2px solid #ff9800; border-radius: 5px; font-weight: bold;">
                        <option value="NEW_UNIT">➕ 建立全新單元 (預設)</option>
                        <option disabled>--- 或選擇下方舊單元進行編輯 ---</option>
                    </select>
                </div>

                <h3 id="form-title" style="margin-top:0; color: #333; font-size: 15px;">📝 單元詳細資料</h3>

                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <label style="font-size: 13px; color: #666;">科目</label>
                        <select id="input-subject" style="padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 5px;">
                            <option value="math">📐 數學</option>
                            <option value="science">🧪 理化</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 13px; color: #666;">順序 (數字)</label>
                        <input type="number" id="input-order" placeholder="例: 1.5" style="padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="font-size: 13px; color: #666;">單元標題</label>
                    <input type="text" id="input-title" placeholder="例如：第三次段考複習" style="padding: 8px; width: 100%; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
                </div>

                <div style="background: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px dashed #ccc;">
                    <p style="margin:0 0 10px 0; font-size:13px; color:#e65100;">💡 若不更新檔案，請留空即可</p>
                    
                    <label style="font-weight:bold; font-size: 14px; display:block; margin-bottom:5px;">📄 題目卷 PDF</label>
                    <input type="file" id="input-file-q" accept="application/pdf" style="width: 100%; margin-bottom: 10px;">
                    <div id="current-q-link" style="font-size:12px; color:#888; margin-bottom:10px;"></div>

                    <label style="font-weight:bold; font-size: 14px; display:block; margin-bottom:5px;">✅ 詳解卷 PDF</label>
                    <input type="file" id="input-file-a" accept="application/pdf" style="width: 100%;">
                    <div id="current-a-link" style="font-size:12px; color:#888;"></div>
                </div>

                <button id="btn-submit-unit" class="btn" style="width: 100%; background-color: #ff9800; color: white; font-weight: bold; padding: 12px;">🚀 建立並上架</button>
                <p id="admin-status" style="text-align: center; color: #666; margin-top: 10px; font-size: 14px;"></p>
            </div>
            
            <div style="margin-top: 15px; display: flex; gap: 10px;">
    <button id="btn-quick-notify-q" class="btn" style="flex:1; background:#e3f2fd; color:#0d47a1; border:none;">🔔 僅通知題目更新</button>
    <button id="btn-quick-notify-a" class="btn" style="flex:1; background:#e8f5e9; color:#1b5e20; border:none;">🔔 僅通知詳解更新</button>
</div>

<button id="btn-check-feedback" class="btn btn-green" style="width: 100%; margin-top: 15px; background-color: #4CAF50; color: white;">
    📩 查看學生意見箱
</button>
            </div>

        <div style="height: 50px;"></div>

    </div> 
    <div id="announcement-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0; color: #d32f2f;">⚠️ 公告詳情</h3>
                <button class="close-btn" id="close-announcement">×</button>
            </div>
            <div class="modal-body" style="padding: 0; background: #f5f5f5;">
    
    <details class="news-item" open> <summary class="news-header">
            <span class="news-tag red">重要</span>
            <span class="news-title">理化第十三章 力與運動(進階資優版) 題目編排疏失說明</span>
            <span class="news-arrow">▼</span>
        </summary>
        <div class="news-content">
            <p>各位同學好，有人反應「理化第十三章 力與運動(進階資優版)」題本有缺失，但在此網站上仍有提供，同學們可自行下載練習。</p>
            <p style="color: #666; font-size: 13px;">發布日期：2026/01/18</p>
            <button class="btn btn-red" id="btn-go-to-target-unit" style="width: 100%; margin-top: 10px;">🚀 前往該單元</button>
        </div>
    </details>

    <details class="news-item">
        <summary class="news-header">
            <span class="news-tag green">說明</span>
            <span class="news-title">註冊帳號</span>
            <span class="news-arrow">▼</span>
        </summary>
        <div class="news-content">
            <p>歡迎大家使用此學習網站，主畫面左上角可註冊帳號，註冊完即可到留言區討論</p>
        </div>
    </details>
    <details class="news-item">
        <summary class="news-header">
            <span class="news-tag green">說明</span>
            <span class="news-title">留言區</span>
            <span class="news-arrow">▼</span>
        </summary>
        <div class="news-content">
            <p>各單元皆設有留言區，同學們可利用留言區在上面發問該單元相關的問題，例如哪一題詳解需要再寫詳細一點等等之類的</p>
        </div>
    </details>
    <details class="news-item">
        <summary class="news-header">
            <span class="news-tag green">說明</span>
            <span class="news-title">答案卷</span>
            <span class="news-arrow">▼</span>
        </summary>
        <div class="news-content">
            <p>答案卷會陸續上傳，若急需哪一單元的詳解可直接在意見箱告知需求</p>
        </div>
    </details>
    <details class="news-item">
        <summary class="news-header">
            <span class="news-tag green">說明</span>
            <span class="news-title">通知中心</span>
            <span class="news-arrow">▼</span>
        </summary>
        <div class="news-content">
            <p>主畫面右上角有個通知中心區，若有新題目新答案或有人留言都會在此通知</p>
        </div>
    </details>

    <details class="news-item">
        <summary class="news-header">
            <span class="news-tag blue">系統</span>
            <span class="news-title">系統維護通知</span>
            <span class="news-arrow">▼</span>
        </summary>
        <div class="news-content">
            <p>為了提供更好的服務，我們會不定時維護系統，維護會提前通知</p>
        </div>
    </details>


</div>
        </div>
    </div>

    <div id="feedback-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📬 投遞意見</h3>
                <button class="close-btn" id="close-feedback">×</button>
            </div>
            <div class="modal-body">
                <p style="color:#666; margin-bottom:10px;">有任何建議或心得？</p>
                <textarea id="feedback-input" class="full-input" rows="5" placeholder="請輸入您的心得或建議..." style="resize: none;"></textarea>
                <button class="btn btn-green" id="btn-submit-feedback" style="margin-top:15px;">送出意見</button>
            </div>
        </div>
    </div>

    <div id="admin-feedback-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>管理員通知 - 意見箱</h3>
                <button class="close-btn" id="close-admin-feedback">×</button>
            </div>
            <div class="modal-body" id="admin-feedback-list">
                <div class="loading-text">載入中...</div>
            </div>
        </div>
    </div>

    <div id="subject-screen" class="page">
        <div id="unit-list-container"></div>
    </div>

    <div id="unit-screen" class="page">
        <div class="tab-container">
            <div class="tab active" data-tab="question">題目卷</div>
            <div class="tab" data-tab="answer">詳解卷</div>
            <div class="tab" data-tab="chat">討論區</div>
        </div>

        <div class="content-area" id="unit-content">
            <div id="panel-question" class="panel active-panel">
                <div id="dl-question" class="download-bar">📥 下載/列印題目卷</div>
                <div id="viewer-question" class="viewer-box"></div>
            </div>

            <div id="panel-answer" class="panel">
                <div id="dl-answer" class="download-bar answer">📥 下載/列印詳解卷</div>
                <div id="viewer-answer" class="viewer-box"></div>
            </div>

            <div id="panel-chat" class="panel">
    <div class="chat-container" id="chat-list">
        <div class="loading-text">載入留言中...</div>
    </div>

    <div class="bottom-action-area">
    <div id="chat-input-area" class="input-row" style="display: none;">
        <input type="text" id="comment-input" class="chat-input" placeholder="輸入問題...">
        <button class="send-btn" id="btn-send-comment">送出</button>
    </div>

    <div id="chat-auth-hint" class="auth-hint-box" style="display: flex;">
        <span>請先註冊或登入以參與討論</span>
        <button class="btn-sm-login" id="btn-quick-login">登入 / 註冊</button>
    </div>
</div>
</div>
        </div>
    </div>

    <div id="notification-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0;">🔔 通知中心 (點擊通知可直接跳轉)</h3>
                <button class="close-btn" id="close-notif">×</button>
            </div>
            <div class="modal-body" id="notif-list">
                <p class="loading-text">載入中...</p>
            </div>
            <button class="btn" style="background: #eee; color: #666; margin-top:15px;" id="btn-close-read">關閉並清除紅點</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <h2>帳號設定</h2>
            <p id="settings-user-info"></p>
            <button class="btn btn-red" id="btn-logout">登出</button>
            <button class="btn btn-gray" id="btn-cancel-settings">取消</button>
        </div>
    </div>

    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0;" id="auth-title">歡迎回來</h3>
                <button class="close-btn" id="close-auth">×</button>
            </div>
            <div class="modal-body">
                
                <div id="login-view">
                    <div class="auth-row">
                        <input type="email" id="login-email" placeholder="Email" class="full-input">
                        <input type="password" id="login-password" placeholder="密碼" class="full-input">
                        <button class="btn-login full-btn" id="btn-do-login">登入</button>
                        
                        <div class="switch-link" id="go-to-register">
                            還沒有帳號嗎？ <strong>點此註冊</strong>
                        </div>
                    </div>
                </div>

                <div id="register-view" class="hidden">
                    <div class="auth-row">
                        <input type="text" id="reg-name" placeholder="姓名 / 暱稱" class="full-input">
                        <input type="email" id="reg-email" placeholder="Email" class="full-input">
                        <input type="password" id="reg-password" placeholder="設定密碼 (至少6碼)" class="full-input">
                        <input type="password" id="reg-confirm-password" placeholder="確認密碼" class="full-input">
                        
                        <button class="btn-register full-btn" id="btn-do-register">註冊</button>

                        <div class="switch-link" id="go-to-login">
                            已經有帳號了？ <strong>返回登入</strong>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>