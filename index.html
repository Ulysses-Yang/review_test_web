<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>學習練習 App</title>
    <link rel="stylesheet" href="style.css">
    
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>
<body>

    <div class="header">
        <div class="icon-btn" id="left-action-btn">
            <ion-icon name="person-circle-outline"></ion-icon>
            <span id="login-label" style="font-size: 14px; margin-left: 5px; font-weight: bold; display:none;">登入/註冊</span>
        </div>
        
        <div class="icon-btn" id="back-btn" style="display: none;">
            <ion-icon name="arrow-back-outline"></ion-icon>
        </div>
        
        <div class="header-title" id="header-title">首頁</div>
        
        <div class="icon-btn" style="position: relative;" id="notif-btn">
            <ion-icon name="notifications-outline" style="color: #007AFF;"></ion-icon>
            <div id="badge" class="badge" style="display: none;">0</div>
        </div>
    </div>

    <div id="home-screen" class="page active">
        <div class="greeting" id="greeting-text">嗨! 同學 選擇科目來練習吧</div>
        
        <div class="card math-card" id="btn-math">
            <h1>📐 數學</h1><p>Mathematics</p>
        </div>
        <div class="card science-card" id="btn-science">
            <h1>🧪 理化</h1><p>Science</p>
        </div>
        
        <div id="teacher-section" style="display: none;" class="teacher-box">
            <p class="teacher-title">--- 老師發送通知區 ---</p>
            <div style="margin: 10px 0; color: #555;">目標單元：</div>
            <select id="admin-unit-select" class="full-select">
                <option value="">載入中...</option>
            </select>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-orange" id="btn-upload-q">📢 通知題目更新</button>
                <button class="btn btn-green" id="btn-upload-a">📢 通知詳解更新</button>
            </div>
        </div>
    </div>

    <div id="subject-screen" class="page">
        <div id="unit-list-container"></div>
    </div>

    <div id="unit-screen" class="page">
        <div class="tab-container">
            <div class="tab active" data-tab="question">題目卷</div>
            <div class="tab" data-tab="answer">詳解卷</div>
            <div class="tab" data-tab="chat">討論區</div>
        </div>

        <div class="content-area" id="unit-content">
            <div id="panel-question" class="panel active-panel">
                <div id="dl-question" class="download-bar">📥 下載/列印題目卷</div>
                <div id="viewer-question" class="viewer-box"></div>
            </div>

            <div id="panel-answer" class="panel">
                <div id="dl-answer" class="download-bar answer">📥 下載/列印詳解卷</div>
                <div id="viewer-answer" class="viewer-box"></div>
            </div>

            <div id="panel-chat" class="panel">
                <div class="chat-container" id="chat-list">
                    <div class="loading-text">載入留言中...</div>
                </div>

                <div class="bottom-action-area">
                    <div id="chat-input-area" class="input-row" style="display: none;">
                        <input type="text" id="comment-input" class="chat-input" placeholder="輸入問題...">
                        <button class="send-btn" id="btn-send-comment">送出</button>
                    </div>
                    <div id="chat-auth-hint" class="auth-hint-box" style="display: flex;">
                        <span>請先註冊或登入以參與討論</span>
                        <button class="btn-sm-login" id="btn-quick-login">登入 / 註冊</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0;">🔔 通知中心</h3>
                <button class="close-btn" id="close-notif">×</button>
            </div>
            <div class="modal-body" id="notif-list">
                <p class="loading-text">載入中...</p>
            </div>
            <button class="btn" style="background: #eee; color: #666; margin-top:15px;" id="btn-close-read">關閉並清除紅點</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <h2>帳號設定</h2>
            <p id="settings-user-info"></p>
            <button class="btn btn-red" id="btn-logout">登出</button>
            <button class="btn btn-gray" id="btn-cancel-settings">取消</button>
        </div>
    </div>

    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0;">🔐 登入或註冊</h3>
                <button class="close-btn" id="close-auth">×</button>
            </div>
            <div class="modal-body">
                <div class="auth-row">
                    <input type="email" id="auth-email" placeholder="Email" class="full-input">
                    <input type="password" id="auth-pwd" placeholder="密碼 (6位以上)" class="full-input">
                    <div class="auth-btns">
                        <button class="btn-login" id="btn-do-login">登入</button>
                        <button class="btn-register" id="btn-do-register">註冊</button>
                    </div>
                    <p style="font-size: 12px; color: #888; text-align: center; margin-top: 10px;">
                        若無帳號，輸入 Email 與密碼後直接按「註冊」即可。
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>